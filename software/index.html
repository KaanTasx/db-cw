<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Реалізація інформаційного та програмного забезпечення | OptiManage</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/db-cw/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <meta name="description" content="Курсова робота з курсу "Бази даних"">
    
    <link rel="preload" href="/db-cw/assets/css/0.styles.96c66562.css" as="style"><link rel="preload" href="/db-cw/assets/js/app.2825c156.js" as="script"><link rel="preload" href="/db-cw/assets/js/2.a6a6c163.js" as="script"><link rel="preload" href="/db-cw/assets/js/23.0184d30b.js" as="script"><link rel="prefetch" href="/db-cw/assets/js/10.c9c5cf8c.js"><link rel="prefetch" href="/db-cw/assets/js/11.fceef510.js"><link rel="prefetch" href="/db-cw/assets/js/12.f9399a4e.js"><link rel="prefetch" href="/db-cw/assets/js/13.ea3d1d23.js"><link rel="prefetch" href="/db-cw/assets/js/14.c2fc06b7.js"><link rel="prefetch" href="/db-cw/assets/js/15.f45c10c8.js"><link rel="prefetch" href="/db-cw/assets/js/16.1b55a862.js"><link rel="prefetch" href="/db-cw/assets/js/17.ba0a0425.js"><link rel="prefetch" href="/db-cw/assets/js/18.9a5d0c12.js"><link rel="prefetch" href="/db-cw/assets/js/19.e7c29f8c.js"><link rel="prefetch" href="/db-cw/assets/js/20.4b6c2972.js"><link rel="prefetch" href="/db-cw/assets/js/21.8f0df66f.js"><link rel="prefetch" href="/db-cw/assets/js/22.bf3eb279.js"><link rel="prefetch" href="/db-cw/assets/js/24.4c904853.js"><link rel="prefetch" href="/db-cw/assets/js/25.ff1e9f6e.js"><link rel="prefetch" href="/db-cw/assets/js/26.e8c39599.js"><link rel="prefetch" href="/db-cw/assets/js/3.2124eb52.js"><link rel="prefetch" href="/db-cw/assets/js/4.6f4418fd.js"><link rel="prefetch" href="/db-cw/assets/js/5.31506af8.js"><link rel="prefetch" href="/db-cw/assets/js/6.d795c82c.js"><link rel="prefetch" href="/db-cw/assets/js/7.54daaa9c.js"><link rel="prefetch" href="/db-cw/assets/js/8.fcc7065c.js"><link rel="prefetch" href="/db-cw/assets/js/9.ffbcebdc.js">
    <link rel="stylesheet" href="/db-cw/assets/css/0.styles.96c66562.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/db-cw/" class="home-link router-link-active"><!----> <span class="site-name">OptiManage</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/db-cw/" class="nav-link">
  Початок
</a></div> <a href="https://github.com/KaanTasx/db-cw.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/db-cw/" class="nav-link">
  Початок
</a></div> <a href="https://github.com/KaanTasx/db-cw.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/db-cw/intro/" class="sidebar-link">Вступ</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/db-cw/requirements/" class="sidebar-heading clickable"><span>Розроблення загальних вимог до системи</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/db-cw/use%20cases/" class="sidebar-link">Розроблення вимог до функціональности системи</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-cw/use%20cases/#загальна-схема" class="sidebar-link">Загальна схема</a></li><li class="sidebar-sub-header"><a href="/db-cw/use%20cases/#користувач" class="sidebar-link">Користувач</a></li><li class="sidebar-sub-header"><a href="/db-cw/use%20cases/#менеджер" class="sidebar-link">Менеджер</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-cw/use%20cases/#адміністратор" class="sidebar-link">Адміністратор</a></li><li class="sidebar-sub-header"><a href="/db-cw/use%20cases/#usersignup" class="sidebar-link">UserSignUp</a></li><li class="sidebar-sub-header"><a href="/db-cw/use%20cases/#usersignin" class="sidebar-link">UserSignIn</a></li><li class="sidebar-sub-header"><a href="/db-cw/use%20cases/#userupdate" class="sidebar-link">UserUpdate</a></li><li class="sidebar-sub-header"><a href="/db-cw/use%20cases/#userdelete" class="sidebar-link">UserDelete</a></li><li class="sidebar-sub-header"><a href="/db-cw/use%20cases/#projectcreate" class="sidebar-link">ProjectCreate</a></li><li class="sidebar-sub-header"><a href="/db-cw/use%20cases/#projectupdate" class="sidebar-link">ProjectUpdate</a></li><li class="sidebar-sub-header"><a href="/db-cw/use%20cases/#projectdelete" class="sidebar-link">ProjectDelete</a></li><li class="sidebar-sub-header"><a href="/db-cw/use%20cases/#useradd" class="sidebar-link">UserAdd</a></li><li class="sidebar-sub-header"><a href="/db-cw/use%20cases/#userdelete-2" class="sidebar-link">UserDelete</a></li><li class="sidebar-sub-header"><a href="/db-cw/use%20cases/#taskadd" class="sidebar-link">TaskAdd</a></li><li class="sidebar-sub-header"><a href="/db-cw/use%20cases/#taskupdate" class="sidebar-link">TaskUpdate</a></li><li class="sidebar-sub-header"><a href="/db-cw/use%20cases/#taskdelete" class="sidebar-link">TaskDelete</a></li><li class="sidebar-sub-header"><a href="/db-cw/use%20cases/#support" class="sidebar-link">Support</a></li></ul></li></ul></li><li><a href="/db-cw/design/" class="sidebar-link">Проектування інформаційного забезпечення</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-cw/design/#модель-бізнес-об-єктів" class="sidebar-link">Модель бізнес-об'єктів</a></li><li class="sidebar-sub-header"><a href="/db-cw/design/#опис-er-моделі" class="sidebar-link">Опис ER-моделі</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-cw/design/#roles-ролі-у-проекті" class="sidebar-link">Roles (Ролі у проекті)</a></li><li class="sidebar-sub-header"><a href="/db-cw/design/#grant-сукупність-прав" class="sidebar-link">Grant (Сукупність прав)</a></li><li class="sidebar-sub-header"><a href="/db-cw/design/#permission-права" class="sidebar-link">Permission (Права)</a></li><li class="sidebar-sub-header"><a href="/db-cw/design/#members-учасники-проекта" class="sidebar-link">Members (Учасники проекта)</a></li><li class="sidebar-sub-header"><a href="/db-cw/design/#users-користувачі" class="sidebar-link">Users (Користувачі)</a></li><li class="sidebar-sub-header"><a href="/db-cw/design/#projects-проєкти" class="sidebar-link">Projects (Проєкти)</a></li><li class="sidebar-sub-header"><a href="/db-cw/design/#task-завдання" class="sidebar-link">Task (Завдання)</a></li><li class="sidebar-sub-header"><a href="/db-cw/design/#participant-учасники-завдання" class="sidebar-link">Participant (Учасники завдання)</a></li></ul></li></ul></li><li><a href="/db-cw/software/" aria-current="page" class="active sidebar-link">Реалізація інформаційного та програмного забезпечення</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-cw/software/#rest-api-для-управління-даними" class="sidebar-link">REST-api для управління даними</a></li><li class="sidebar-sub-header"><a href="/db-cw/software/#запуск" class="sidebar-link">Запуск</a></li><li class="sidebar-sub-header"><a href="/db-cw/software/#засоби-тестування" class="sidebar-link">Засоби тестування</a></li><li class="sidebar-sub-header"><a href="/db-cw/software/#код" class="sidebar-link">Код</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-cw/software/#server-js" class="sidebar-link">server.js</a></li><li class="sidebar-sub-header"><a href="/db-cw/software/#methods-js" class="sidebar-link">methods.js</a></li><li class="sidebar-sub-header"><a href="/db-cw/software/#database-js" class="sidebar-link">database.js</a></li></ul></li><li class="sidebar-sub-header"><a href="/db-cw/software/#скрипт-для-початкового-наповнення-бази-даних" class="sidebar-link">Скрипт для початкового наповнення бази даних</a></li></ul></li><li><a href="/db-cw/test/" class="sidebar-link">Тестування працездатності системи</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-cw/test/#засоби-тестування" class="sidebar-link">Засоби тестування</a></li><li class="sidebar-sub-header"><a href="/db-cw/test/#код" class="sidebar-link">Код</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/db-cw/test/#getall-sh" class="sidebar-link">getAll.sh</a></li><li class="sidebar-sub-header"><a href="/db-cw/test/#getone-sh" class="sidebar-link">getOne.sh</a></li><li class="sidebar-sub-header"><a href="/db-cw/test/#register-sh" class="sidebar-link">register.sh</a></li><li class="sidebar-sub-header"><a href="/db-cw/test/#login-sh" class="sidebar-link">login.sh</a></li><li class="sidebar-sub-header"><a href="/db-cw/test/#update-sh" class="sidebar-link">update.sh</a></li></ul></li><li class="sidebar-sub-header"><a href="/db-cw/test/#delete-sh" class="sidebar-link">delete.sh</a></li></ul></li><li><a href="/db-cw/conclusion/" class="sidebar-link">Висновки</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="реалізація-інформаціиного-та-програмного-забезпечення"><a href="#реалізація-інформаціиного-та-програмного-забезпечення" class="header-anchor">#</a> Реалізація інформаційного та програмного забезпечення</h1> <p>В рамках проєкту розробляється:</p> <h2 id="rest-api-для-управління-даними"><a href="#rest-api-для-управління-даними" class="header-anchor">#</a> REST-api для управління даними</h2> <h2 id="запуск"><a href="#запуск" class="header-anchor">#</a> Запуск</h2> <p>Описано в <a href="https://github.com/KaanTasx/db-cw/blob/master/src/js/README.md" target="_blank" rel="noopener noreferrer">цьому README<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="засоби-тестування"><a href="#засоби-тестування" class="header-anchor">#</a> Засоби тестування</h2> <p>Було створено API на базі fastify яке може взаємдіяти з базою ланих і реалізує основні use cases. Взаємодіяти з ним пропонується з sh файлами в папці test. Ці файли відповідають кожен певному сценарію використання й здатні приймати аргументи з командного рядка.</p> <h2 id="код"><a href="#код" class="header-anchor">#</a> Код</h2> <h3 id="server-js"><a href="#server-js" class="header-anchor">#</a> server.js</h3> <p>Вхідна точка. Тут запускається сервер і створюються роути й хуки.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> fastify <span class="token keyword">from</span> <span class="token string">&quot;fastify&quot;</span>
<span class="token keyword">import</span> dotenv <span class="token keyword">from</span> <span class="token string">&quot;dotenv&quot;</span>
<span class="token keyword">import</span>  jwt <span class="token keyword">from</span> <span class="token string">&quot;@fastify/jwt&quot;</span>
<span class="token keyword">import</span> sql <span class="token keyword">from</span> <span class="token string">&quot;@fastify/mysql&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> dbConfig<span class="token punctuation">,</span> initDB <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./database.js&quot;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> methods <span class="token keyword">from</span> <span class="token string">&quot;./methods.js&quot;</span>

dotenv<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">fastify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">logger</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>jwt<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">secret</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">JWT_KEY</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">promise</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">host</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">HOST</span><span class="token punctuation">,</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_USER</span><span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PASSWORD</span><span class="token punctuation">,</span>
    <span class="token literal-property property">database</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DATABASE</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_PORT</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">setErrorHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> _request<span class="token punctuation">,</span> reply</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    server<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    reply<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">'Internal Server Error'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">addHook</span><span class="token punctuation">(</span><span class="token string">'onRequest'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> reply</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>method <span class="token operator">!==</span> <span class="token string">'UPDATE'</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>request<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/users'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span>

    <span class="token keyword">const</span> token <span class="token operator">=</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token keyword">return</span> reply<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">'Unauthorized'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> decoded <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">jwtVerify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>decoded<span class="token punctuation">)</span> <span class="token keyword">return</span> reply<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">'Unauthorized'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>decoded<span class="token punctuation">.</span>id <span class="token operator">!==</span> request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token keyword">return</span> reply<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">'Unauthorized'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/users'</span><span class="token punctuation">,</span> methods<span class="token punctuation">.</span>getAllUsers<span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/users/:id'</span><span class="token punctuation">,</span> methods<span class="token punctuation">.</span>getUser<span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/sign-up'</span><span class="token punctuation">,</span> methods<span class="token punctuation">.</span>signUserUp<span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/sign-in'</span><span class="token punctuation">,</span> methods<span class="token punctuation">.</span>signUserIn<span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/users'</span><span class="token punctuation">,</span> methods<span class="token punctuation">.</span>updateUser<span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'/users/:username'</span><span class="token punctuation">,</span> methods<span class="token punctuation">.</span>deleteUser<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">startServer</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">3000</span>
        <span class="token keyword">await</span> server<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">port</span><span class="token operator">:</span> port <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">startServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>


</code></pre></div><h3 id="methods-js"><a href="#methods-js" class="header-anchor">#</a> methods.js</h3> <p>В собі містить функції, які виконуються при певному роуті</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> db <span class="token keyword">from</span> <span class="token string">&quot;./database.js&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getUser</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> reply</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>id<span class="token punctuation">)</span> <span class="token keyword">return</span> reply<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&quot;Bad request&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>server<span class="token punctuation">,</span> id<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token keyword">return</span> reply<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&quot;User not found&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    reply<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getAllUsers</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> reply</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">getAllUsers</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>server<span class="token punctuation">)</span>
    reply<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">signUserUp</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> reply</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> id<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> fullName<span class="token punctuation">,</span> email <span class="token punctuation">}</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>body
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>id <span class="token operator">||</span> <span class="token operator">!</span>username <span class="token operator">||</span> <span class="token operator">!</span>password <span class="token operator">||</span> <span class="token operator">!</span>fullName <span class="token operator">||</span> <span class="token operator">!</span>email<span class="token punctuation">)</span> <span class="token keyword">return</span> reply<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&quot;Bad request&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>server<span class="token punctuation">,</span> username<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token keyword">return</span> reply<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">409</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&quot;User already exists&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>server<span class="token punctuation">,</span> id<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> fullName<span class="token punctuation">,</span> email<span class="token punctuation">)</span>
    reply<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;User created&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> result<span class="token punctuation">.</span>insertId <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">signUserIn</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> reply</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> username<span class="token punctuation">,</span> password <span class="token punctuation">}</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>body
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>username <span class="token operator">||</span> <span class="token operator">!</span>password<span class="token punctuation">)</span> <span class="token keyword">return</span> reply<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&quot;Bad request&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">getUserByName</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>server<span class="token punctuation">,</span> username<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token keyword">return</span> reply<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&quot;User not found&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>password <span class="token operator">!==</span> password<span class="token punctuation">)</span> <span class="token keyword">return</span> reply<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&quot;Wrong password&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span>server<span class="token punctuation">.</span>jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> user<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token literal-property property">username</span><span class="token operator">:</span> user<span class="token punctuation">.</span>username <span class="token punctuation">}</span><span class="token punctuation">)</span>

    reply<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;Logged in&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">token</span><span class="token operator">:</span> token <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">updateUser</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> reply</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> fullName<span class="token punctuation">,</span> email <span class="token punctuation">}</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>body
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>username <span class="token operator">||</span> <span class="token operator">!</span>password <span class="token operator">||</span> <span class="token operator">!</span>fullName <span class="token operator">||</span> <span class="token operator">!</span>email<span class="token punctuation">)</span> <span class="token keyword">return</span> reply<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&quot;Bad request&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token keyword">const</span> id <span class="token operator">=</span> request<span class="token punctuation">.</span>server<span class="token punctuation">.</span>jwt<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>id
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>id<span class="token punctuation">)</span> <span class="token keyword">return</span> reply<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&quot;Unauthorized&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>server<span class="token punctuation">,</span> id<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token keyword">return</span> reply<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&quot;User not found&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">updateUser</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>server<span class="token punctuation">,</span> id<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> fullName<span class="token punctuation">,</span> email<span class="token punctuation">)</span>
    reply<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;User updated&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> result<span class="token punctuation">.</span>insertId <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">deleteUser</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> reply</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> username <span class="token operator">=</span> request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>username
    <span class="token keyword">const</span> <span class="token punctuation">{</span> password <span class="token punctuation">}</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>body
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>username <span class="token operator">||</span> <span class="token operator">!</span>password<span class="token punctuation">)</span> <span class="token keyword">return</span> reply<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&quot;Bad request&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">getUserByName</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>server<span class="token punctuation">,</span> username<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token keyword">return</span> reply<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&quot;User not found&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>password <span class="token operator">!==</span> password<span class="token punctuation">)</span> <span class="token keyword">return</span> reply<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&quot;Wrong password&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">deleteUser</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>server<span class="token punctuation">,</span> user<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
    reply<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;User deleted&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> result<span class="token punctuation">.</span>insertId <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="database-js"><a href="#database-js" class="header-anchor">#</a> database.js</h3> <p>Містить у собі взаємодію з базою даних. Мета відокремлення файлу полягає в можливості використання іншої бд замість mysql.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token string">'use strict'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> readFile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;fs/promises&quot;</span>
<span class="token keyword">import</span> dotenv <span class="token keyword">from</span> <span class="token string">&quot;dotenv&quot;</span>

<span class="token keyword">const</span> env <span class="token operator">=</span> dotenv<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> dbConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">host</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">HOST</span><span class="token punctuation">,</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">USER</span><span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PASSWORD</span><span class="token punctuation">,</span>
    <span class="token literal-property property">database</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DATABASE</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_PORT</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">initDB</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">fastify</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;../sql/init.sql&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> rows <span class="token operator">=</span> <span class="token keyword">await</span> fastify<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>
    <span class="token keyword">return</span> rows
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getUser</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">fastify<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>rows<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> fastify<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM users WHERE id = ?&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rows<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span>
    <span class="token keyword">return</span> rows<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getUserByName</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">fastify<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>rows<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> fastify<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM users WHERE username = ?&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rows<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span>
    <span class="token keyword">return</span> rows<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getAllUsers</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">fastify</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>rows<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> fastify<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM users&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> rows
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">addUser</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">fastify<span class="token punctuation">,</span> id<span class="token punctuation">,</span> userName<span class="token punctuation">,</span> password<span class="token punctuation">,</span> fullName<span class="token punctuation">,</span> email</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>rows<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> fastify<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO users (id, username, password, full_name, email) VALUES (?, ?, ?, ?, ?)&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>id<span class="token punctuation">,</span> userName<span class="token punctuation">,</span> password<span class="token punctuation">,</span> fullName<span class="token punctuation">,</span> email<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> rows
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">updateUser</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">fastify<span class="token punctuation">,</span> id<span class="token punctuation">,</span> userName<span class="token punctuation">,</span> password<span class="token punctuation">,</span> fullName<span class="token punctuation">,</span> email</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>rows<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> fastify<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;UPDATE users SET username = ?, password = ?, full_name = ?, email = ? WHERE id = ?&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>userName<span class="token punctuation">,</span> password<span class="token punctuation">,</span> fullName<span class="token punctuation">,</span> email<span class="token punctuation">,</span> id<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> rows
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">deleteUser</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">fastify<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>rows<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> fastify<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;DELETE FROM users WHERE id = ?&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> rows
<span class="token punctuation">}</span>
</code></pre></div><h2 id="скрипт-для-початкового-наповнення-бази-даних"><a href="#скрипт-для-початкового-наповнення-бази-даних" class="header-anchor">#</a> Скрипт для початкового наповнення бази даних</h2> <div class="language-sql extra-class"><pre class="language-sql"><code>
<span class="token comment">-- CreateEnum</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TYPE</span> <span class="token string">&quot;Status&quot;</span> <span class="token keyword">AS</span> <span class="token keyword">ENUM</span> <span class="token punctuation">(</span><span class="token string">'COMPLETED'</span><span class="token punctuation">,</span> <span class="token string">'IN_PROGRESS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- CreateTable</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;users&quot;</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;id&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;username&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;email&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;password&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;full_name&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>

    <span class="token keyword">CONSTRAINT</span> <span class="token string">&quot;users_pkey&quot;</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- CreateTable</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;projects&quot;</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;id&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;name&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;description&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;status&quot;</span> <span class="token string">&quot;Status&quot;</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>

    <span class="token keyword">CONSTRAINT</span> <span class="token string">&quot;projects_pkey&quot;</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- CreateTable</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;members&quot;</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;id&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;user_id&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;project_id&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>

    <span class="token keyword">CONSTRAINT</span> <span class="token string">&quot;members_pkey&quot;</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- CreateTable</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;roles&quot;</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;id&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;name&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;member)id&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>

    <span class="token keyword">CONSTRAINT</span> <span class="token string">&quot;roles_pkey&quot;</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- CreateTable</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;grants&quot;</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;id&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;role_id&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>

    <span class="token keyword">CONSTRAINT</span> <span class="token string">&quot;grants_pkey&quot;</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- CreateTable</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;permissions&quot;</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;id&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;permission&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;grantId&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>

    <span class="token keyword">CONSTRAINT</span> <span class="token string">&quot;permissions_pkey&quot;</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- CreateTable</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;tasks&quot;</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;id&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;name&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;description&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;status&quot;</span> <span class="token string">&quot;Status&quot;</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;price&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;deadline&quot;</span> <span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;project_id&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>

    <span class="token keyword">CONSTRAINT</span> <span class="token string">&quot;tasks_pkey&quot;</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- CreateTable</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;partipicants&quot;</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;id&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;name&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;user_id&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">&quot;task_id&quot;</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>

    <span class="token keyword">CONSTRAINT</span> <span class="token string">&quot;partipicants_pkey&quot;</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- CreateIndex</span>
<span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> <span class="token string">&quot;users_username_key&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- CreateIndex</span>
<span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> <span class="token string">&quot;users_email_key&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- CreateIndex</span>
<span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> <span class="token string">&quot;roles_member)id_key&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;roles&quot;</span><span class="token punctuation">(</span><span class="token string">&quot;member)id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- AddForeignKey</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;members&quot;</span> <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> <span class="token string">&quot;members_user_id_fkey&quot;</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token string">&quot;user_id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">;</span>

<span class="token comment">-- AddForeignKey</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;members&quot;</span> <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> <span class="token string">&quot;members_project_id_fkey&quot;</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token string">&quot;project_id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token string">&quot;projects&quot;</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">;</span>

<span class="token comment">-- AddForeignKey</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;roles&quot;</span> <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> <span class="token string">&quot;roles_member)id_fkey&quot;</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token string">&quot;member)id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token string">&quot;members&quot;</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">;</span>

<span class="token comment">-- AddForeignKey</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;grants&quot;</span> <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> <span class="token string">&quot;grants_role_id_fkey&quot;</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token string">&quot;role_id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token string">&quot;roles&quot;</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">;</span>

<span class="token comment">-- AddForeignKey</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;permissions&quot;</span> <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> <span class="token string">&quot;permissions_grantId_fkey&quot;</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token string">&quot;grantId&quot;</span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token string">&quot;grants&quot;</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">;</span>

<span class="token comment">-- AddForeignKey</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;tasks&quot;</span> <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> <span class="token string">&quot;tasks_project_id_fkey&quot;</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token string">&quot;project_id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token string">&quot;projects&quot;</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">;</span>

<span class="token comment">-- AddForeignKey</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;partipicants&quot;</span> <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> <span class="token string">&quot;partipicants_user_id_fkey&quot;</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token string">&quot;user_id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token string">&quot;members&quot;</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">;</span>

<span class="token comment">-- AddForeignKey</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token string">&quot;partipicants&quot;</span> <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> <span class="token string">&quot;partipicants_task_id_fkey&quot;</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token string">&quot;task_id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token string">&quot;tasks&quot;</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">;</span>


</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Останнє оновлення:</span> <span class="time">6/4/2024, 9:23:09 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/db-cw/design/" class="prev">
        Проектування інформаційного забезпечення
      </a></span> <span class="next"><a href="/db-cw/test/">
        Тестування працездатності системи
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/db-cw/assets/js/app.2825c156.js" defer></script><script src="/db-cw/assets/js/2.a6a6c163.js" defer></script><script src="/db-cw/assets/js/23.0184d30b.js" defer></script>
  </body>
</html>
